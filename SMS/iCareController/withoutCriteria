@RestController
@RequestMapping(path = "/outgoing")
public class iCareController {
    private final iCareService icareService;

    public iCareController(iCareService icareService) {
        this.icareService = icareService;
    }

    @CrossOrigin()
    @PostMapping(value = "/send", produces = MediaType.APPLICATION_JSON_VALUE)
    public ResponseEntity<String> handleRequest(HttpServletRequest request,
                                                @RequestParam(name = "action") String action,
                                                @RequestParam(name = "patientPhoneNo", required = false) String patientPhoneNo,
                                                @RequestParam(name = "providerPhoneNo", required = false) String providerPhoneNo,
                                                @RequestParam(name = "userPhoneNo", required = false) String userPhoneNo,
                                                @RequestParam(name = "criteria", required = false) String criteria,
                                                @RequestParam(name = "status", required = false) String status,
                                                @RequestParam(name = "message", required = false) String message
    ) throws JSONException {
        if (iCareConfig.ACTION_OUTGOING.equals(action)){
            SMSRequestPayload payload = new SMSRequestPayload();
            payload.setPatientPhoneNo(patientPhoneNo);
            payload.setProviderPhoneNo(providerPhoneNo);
            payload.setUserPhoneNo(userPhoneNo);
            payload.setStatus(status);
            payload.setMessage(message);
            icareService.processSMSRequest(payload);
        }
        return new ResponseEntity<>("SMS sent successfully.",HttpStatus.OK);
 }

}
